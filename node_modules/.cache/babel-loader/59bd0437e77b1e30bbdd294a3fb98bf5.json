{"remainingRequest":"E:\\HtmlProjects\\wsadmin\\node_modules\\thread-loader\\dist\\cjs.js!E:\\HtmlProjects\\wsadmin\\node_modules\\babel-loader\\lib\\index.js!E:\\HtmlProjects\\wsadmin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\HtmlProjects\\wsadmin\\src\\components\\prod\\prodInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\HtmlProjects\\wsadmin\\src\\components\\prod\\prodInfo.vue","mtime":1573440952651},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576862582236},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576862582236},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.function.name\";\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar AttributeIndex = function AttributeIndex() {\n  return import('./shopAttribute.vue');\n};\n\nvar SecondIndex = function SecondIndex() {\n  return import('./shoptype.vue');\n};\n\nimport { getProdDetailAPI, getTemplateListAPI, pushProdDataAPI, putProdDataAPI } from '@/api/productApi.js';\nimport axios from 'axios';\nimport { treeDataTranslate, idList } from '@/utils';\nimport E from 'wangeditor';\nimport SkuTable from './sku-table';\nimport SkuTag from './sku-tag';\nexport default {\n  name: 'editor',\n  data: function data() {\n    return {\n      // 分类树展示与回显\n      transportId: null,\n      shopid: 0,\n      shopup: '1',\n      shopdown: '1',\n      value1: '',\n      attrtext: '',\n      attributeDepList: [],\n      category: {\n        list: [],\n        selected: [],\n        props: {\n          value: 'categoryId',\n          label: 'categoryName'\n        }\n      },\n      rules: {\n        checkList: [{\n          type: 'array',\n          required: true,\n          message: '请选择代理购买方式',\n          trigger: 'change'\n        }],\n        picfile: [{\n          required: true,\n          message: '请上传图片'\n        }]\n      },\n      fileList: [],\n      freightlist: [],\n      allfreight: '',\n      AttributeDepShow: false,\n      secondDepShow: false,\n      imageShowUrl: '',\n      // 规格列表\n      shoptypelist: [],\n      skuList: [],\n      prodName: '',\n      dialogImageUrl: '',\n      dialogVisible: false,\n      dataForm: {\n        checkList: [],\n        productType: 0,\n        sid: 0,\n        productNumber: '',\n        productName: '',\n        cover: '',\n        productIntro: '',\n        price: '',\n        inviteReward: '',\n        marketPrice: '',\n        weight: '',\n        stockPrice: '',\n        isUniformFreight: '0',\n        showStock: 1,\n        content: '',\n        retailFreightId: '',\n        agentFreightId: '',\n        cloudFreightId: '',\n        sales: '',\n        agentBuy: '',\n        sort: '',\n        putawayTime: '',\n        soldoutTime: '',\n        typeIds: [],\n        productParams: [],\n        units: [],\n        standardDtos: [],\n        productImageDtos: []\n      },\n      tags: [] // resourcesUrl: window.SITE_CONFIG.resourcesUrl\n\n    };\n  },\n  components: {\n    SkuTable: SkuTable,\n    SkuTag: SkuTag,\n    SecondIndex: SecondIndex,\n    AttributeIndex: AttributeIndex\n  },\n  props: {\n    depId: {\n      required: true\n    }\n  },\n  computed: {\n    defalutSku: function defalutSku() {\n      return this.$store.state.prod.defalutSku;\n    }\n  },\n  activated: function activated() {\n    this.dataForm.prodId = this.$route.query.prodId;\n    this.getDataList();\n  },\n  methods: {\n    // 获取分类数据\n    getDataList: function getDataList() {},\n    handleRemove: function handleRemove(file, fileList) {\n      for (var i = 0; i < this.dataForm.productImageDtos.length; i++) {\n        if (file.url == this.dataForm.productImageDtos[i].url) {\n          this.dataForm.productImageDtos.splice(i, 1);\n        }\n      }\n    },\n    uploadImgTwo: function uploadImgTwo(res) {\n      this.dataForm.productImageDtos.push({\n        sort: 0,\n        url: res.data\n      });\n    },\n    handlePictureCardPreview: function handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url;\n      this.dialogVisible = true;\n    },\n    removeDomain: function removeDomain(item) {\n      for (var j = 0; j < this.attributeDepList.length; j++) {\n        if (this.attributeDepList[j].name == item.name) {\n          this.attributeDepList.splice(j, 1);\n        }\n      }\n    },\n    delshoptype: function delshoptype(deltid) {\n      for (var i = 0; i < this.shoptypelist.length; i++) {\n        if (this.shoptypelist[i].tid == deltid) {\n          this.shoptypelist.splice(i, 1);\n        }\n      }\n    },\n    saveattrtext: function saveattrtext() {\n      var isokpush = true;\n\n      for (var j = 0; j < this.attributeDepList.length; j++) {\n        if (this.attributeDepList[j].name == this.attrtext) {\n          isokpush = false;\n          this.$message({\n            type: 'error',\n            message: '不能添加已有属性值'\n          });\n        }\n      }\n\n      if (isokpush) {\n        if (this.attrtext != '') {\n          this.attributeDepList.push({\n            name: this.attrtext,\n            value: ''\n          });\n          this.attrtext = '';\n        } else {\n          this.$message({\n            type: 'error',\n            message: '属性值不能为空'\n          });\n        }\n      }\n    },\n    changeshoptype: function changeshoptype(typelist) {\n      this.shoptypelist = typelist;\n    },\n    changeattrlist: function changeattrlist(attrlist) {\n      var attribute = attrlist.split(',');\n\n      for (var i = 0; i < attribute.length; i++) {\n        var ischeck = true;\n\n        for (var j = 0; j < this.attributeDepList.length; j++) {\n          if (this.attributeDepList[j].name == attribute[i]) {\n            ischeck = false;\n          }\n        }\n\n        if (ischeck) {\n          this.attributeDepList.push({\n            name: attribute[i],\n            value: ''\n          });\n        }\n      }\n    },\n    handleChange: function handleChange() {},\n    handleSecondDepShow: function handleSecondDepShow() {\n      this.secondDepShow = true;\n    },\n    handleAttributeDepShow: function handleAttributeDepShow() {\n      this.AttributeDepShow = true;\n    },\n    uploadImg: function uploadImg(res) {\n      this.dataForm.cover = res.data;\n      this.imageShowUrl = res.data;\n      this.rules.picfile = [{\n        required: true,\n        message: '请上传图片'\n      }];\n\n      if (this.dataForm.cover != '') {\n        this.rules.picfile = [];\n      }\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n      var isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG或者PNG 格式!');\n      }\n\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n\n      return isJPG && isLt2M;\n    },\n    // 获取分类信息\n    getCategoryList: function getCategoryList() {},\n    // 选择分类改变事件\n    handleCategoryChange: function handleCategoryChange(val) {\n      this.dataForm.categoryId = val[val.length - 1];\n    },\n    // 表单提交\n    dataFormSubmit: function dataFormSubmit() {\n      var _this = this;\n\n      var that = this;\n      this.$refs['dataForm'].validate(function (valid) {\n        if (valid) {\n          if (_this.shoptypelist.length < 1) {\n            _this.$message({\n              type: 'error',\n              message: '产品分类不能为空'\n            });\n\n            return false;\n          }\n\n          var pushdata = _this.dataForm;\n\n          if (_this.dataForm.checkList.length == 0) {\n            pushdata.agentBuy = 0;\n          } else if (_this.dataForm.checkList.length == 2) {\n            pushdata.agentBuy = 3;\n          } else {\n            if (_this.dataForm.checkList[0] == '物流进货') {\n              pushdata.agentBuy = 1;\n            } else {\n              pushdata.agentBuy = 2;\n            }\n          }\n\n          if (_this.shopup == 1) {\n            pushdata.putawayTime = 0;\n\n            if (_this.shopdown == 2) {\n              pushdata.soldoutTime = 0;\n            }\n          } else if (_this.shopup == 3) {\n            pushdata.putawayTime = 0;\n            pushdata.soldoutTime = 0;\n          } else {\n            if (_this.shopdown == 2) {\n              pushdata.soldoutTime = 0;\n            }\n          }\n\n          pushdata.standardDtos = [];\n          pushdata.productGuigeNames = [];\n\n          if (_this.skuList.length > 0) {\n            var skuguigelist = _this.skuList[0].properties.split(';');\n\n            if (skuguigelist.length == 1) {\n              pushdata.productGuigeNames.push({\n                gname: skuguigelist[0],\n                lvevl: 1\n              });\n            } else {\n              pushdata.productGuigeNames.push({\n                gname: skuguigelist[0],\n                lvevl: 1\n              }, {\n                gname: skuguigelist[1],\n                lvevl: 2\n              });\n            }\n          }\n\n          for (var i = 0; i < _this.skuList.length; i++) {\n            var skulistdata = {\n              sp1: '',\n              sp2: '',\n              productNumber: '',\n              price: '',\n              weight: '',\n              pic: ''\n            };\n\n            var skulistsplist = _this.skuList[i].properties.split(';');\n\n            if (skulistsplist.length <= 1) {\n              skulistdata.sp1 = skulistsplist[0].split(':')[1];\n              skulistdata.productNumber = _this.skuList[i].productNumber;\n              skulistdata.weight = _this.skuList[i].weight;\n              skulistdata.price = _this.skuList[i].price;\n              skulistdata.pic = _this.skuList[i].pic;\n            } else {\n              skulistdata.sp1 = skulistsplist[0].split(':')[1];\n              skulistdata.sp2 = skulistsplist[1].split(':')[1];\n              skulistdata.productNumber = _this.skuList[i].productNumber;\n              skulistdata.weight = _this.skuList[i].weight;\n              skulistdata.price = _this.skuList[i].price;\n              skulistdata.pic = _this.skuList[i].pic;\n            }\n\n            pushdata.standardDtos.push(skulistdata);\n          }\n\n          pushdata.typeIds = [];\n\n          for (var _i = 0; _i < _this.shoptypelist.length; _i++) {\n            pushdata.typeIds.push(_this.shoptypelist[_i].tid);\n          }\n\n          if (_this.dataForm.isUniformFreight == 2) {\n            pushdata.retailFreightId = _this.allfreight;\n            pushdata.agentFreightId = _this.allfreight;\n            pushdata.cloudFreightId = _this.allfreight;\n          }\n\n          pushdata.productType = 0;\n\n          if (_this.shopid != 0) {\n            var putdata = {\n              pid: _this.shopid,\n              productType: 0,\n              productNumber: pushdata.productNumber,\n              cover: pushdata.cover,\n              productName: pushdata.productName,\n              productIntro: '',\n              price: pushdata.price,\n              isUniformFreight: pushdata.isUniformFreight,\n              marketPrice: pushdata.marketPrice,\n              weight: pushdata.weight,\n              showStock: pushdata.showStock,\n              content: pushdata.content,\n              retailFreightId: pushdata.retailFreightId,\n              agentFreightId: pushdata.agentFreightId,\n              cloudFreightId: pushdata.cloudFreightId,\n              sales: pushdata.sales,\n              sort: pushdata.sort,\n              inviteReward: pushdata.inviteReward,\n              stockPrice: pushdata.stockPrice,\n              putawayTime: pushdata.putawayTime,\n              soldoutTime: pushdata.soldoutTime,\n              typeIds: pushdata.typeIds,\n              productParams: pushdata.productParams,\n              units: pushdata.units,\n              standardDtos: pushdata.standardDtos,\n              productImageDtos: pushdata.productImageDtos\n            };\n            putProdDataAPI(putdata).then(function (res) {\n              var sucresponse = res.data;\n\n              if (sucresponse.code == 200) {\n                _this.$message({\n                  type: 'success',\n                  message: '修改产品成功'\n                });\n\n                _this.$emit('close-form');\n\n                _this.$emit('finish-action');\n              } else {\n                _this.errorMsg(sucresponse.message);\n              }\n            }).catch(function (err) {\n              console.log(err);\n              _this.tableLoading = false;\n            });\n          } else {\n            pushProdDataAPI(pushdata).then(function (res) {\n              var response = res.data;\n\n              if (response.code == 200) {\n                _this.$message({\n                  type: 'success',\n                  message: '添加产品成功'\n                });\n\n                _this.$emit('close-form');\n\n                _this.$emit('finish-action');\n              } else {\n                _this.errorMsg(response.message);\n              }\n            }).catch(function (err) {\n              console.log(err);\n              _this.tableLoading = false;\n            });\n          }\n        }\n      });\n    },\n    paramSetPriceAndStocks: function paramSetPriceAndStocks(param) {},\n    skuTagChangeSkuHandler: function skuTagChangeSkuHandler(skuList) {\n      var prodName = this.prodName;\n      skuList.forEach(function (sku) {\n        if (sku.properties) {\n          sku.skuName = '';\n          var properties = sku.properties.split(';');\n\n          for (var propertiesKey in properties) {\n            sku.skuName += properties[propertiesKey].split(':')[1] + ' ';\n          }\n\n          sku.prodName = prodName + ' ' + sku.skuName;\n        }\n      });\n      this.skuList = skuList;\n    },\n    getproddetail: function getproddetail(id) {\n      var _this2 = this;\n\n      getProdDetailAPI(id).then(function (res) {\n        var data = res.data.data;\n        _this2.dataForm = data;\n        _this2.dataForm.productImageDtos = data.productImageList;\n        _this2.rules.picfile = [{\n          required: true,\n          message: '请上传图片'\n        }];\n\n        if (_this2.dataForm.cover != '') {\n          _this2.rules.picfile = [];\n        }\n\n        if (data.agentBuy = 0) {\n          _this2.dataForm.checkList = [];\n        } else if (data.agentBuy = 3) {\n          _this2.dataForm.checkList = [\"物流进货\", \"云仓库储货\"];\n        } else {\n          if (data.agentBuy = 1) {\n            _this2.dataForm.checkList = [\"物流进货\"];\n          } else {\n            _this2.dataForm.checkList = [\"云仓库储货\"];\n          }\n        }\n\n        _this2.shoptypelist = data.productTypeList;\n        _this2.dataForm.isUniformFreight = data.isUniformFreight;\n        _this2.attributeDepList = data.productParamList;\n        var skulistData = data.productSkuList;\n        var skunamelist = data.productGuigeNameList;\n\n        for (var i = 0; i < skulistData.length; i++) {\n          var skulistpushdata = {\n            pic: \"\",\n            price: 0,\n            prodName: \" 标签值 二级标签值 \",\n            productNumber: 0,\n            properties: \"一级标签:标签值;二级标签:二级标签值\",\n            skuName: \"标签值 二级标签值 \",\n            status: 1,\n            weight: 0\n          };\n          skulistpushdata.pic = skulistData[i].pic;\n          skulistpushdata.price = skulistData[i].price;\n          skulistpushdata.weight = skulistData[i].weight;\n          skulistpushdata.productNumber = skulistData[i].productNumber;\n\n          if (skunamelist.length == 2) {\n            skulistpushdata.properties = skunamelist[0].gname + ':' + skulistData[i].sp1 + ';' + skunamelist[1].gname + ':' + skulistData[i].sp2;\n            skulistpushdata.skuName = skulistData[i].sp1 + ' ' + skulistData[i].sp2;\n            skulistpushdata.prodName = ' ' + skulistData[i].sp1 + ' ' + skulistData[i].sp2 + ' ';\n          } else {\n            skulistpushdata.skuName = skulistData[i].sp1;\n            skulistpushdata.properties = skunamelist[0].gname + ':' + skulistData[i].sp1;\n            skulistpushdata.skuName = skulistData[i].sp1;\n            skulistpushdata.prodName = ' ' + skulistData[i].sp1;\n          }\n\n          _this2.skuList.push(skulistpushdata);\n        }\n\n        if (data.status == -1) {\n          _this2.shopup = \"3\";\n        } else {\n          if (data.putawayTime == 0) {\n            _this2.shopup = \"1\";\n\n            if (data.soldoutTime != 0) {\n              _this2.shopdown = \"1\";\n            } else {\n              _this2.shopdown = \"2\";\n            }\n          } else {\n            _this2.shopup = \"2\";\n\n            if (data.soldoutTime != 0) {\n              _this2.shopdown = \"1\";\n            } else {\n              _this2.shopdown = \"2\";\n            }\n          }\n        }\n\n        var editor = new E('#editorElem');\n\n        editor.customConfig.onchange = function (html) {\n          _this2.dataForm.content = html;\n        };\n\n        editor.customConfig.customUploadImg = function (files, insert) {\n          var formData = new FormData();\n          formData.append('files', files[0]);\n          axios.post(\"http://admin.zhanchengwlkj.com:8080/derivative_system_backstage/file/addFile\", formData, {\n            headers: {\n              \"Content-Type\": \"multipart/form-data\"\n            }\n          }).then(function (res) {\n            var data = res.data;\n            insert(data.data); // 插入图片到editor\n          }); // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n        };\n\n        editor.customConfig.uploadImgShowBase64 = true; //图片以base64形式保存\n\n        editor.create();\n        editor.txt.html(_this2.dataForm.content);\n      }).catch(function (err) {\n        _this2.tableLoading = false;\n      });\n    },\n    errorMsg: function errorMsg(message) {\n      this.$message({\n        message: message,\n        type: 'error',\n        duration: 1500\n      });\n    },\n    getfreightlist: function getfreightlist() {\n      var _this3 = this;\n\n      var getTempParam = {\n        current: 1,\n        size: 100\n      };\n      getTemplateListAPI(getTempParam).then(function (res) {\n        var response = res.data.data.records;\n        _this3.freightlist = response;\n      }).catch(function (err) {\n        _this3.tableLoading = false;\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this4 = this;\n\n    //wangEditor自带方法\n    if (this.depId != 0) {\n      this.shopid = this.depId;\n      this.getproddetail(this.depId);\n    } else {\n      var editor = new E('#editorElem');\n      editor.customConfig.uploadImgShowBase64 = true; //图片以base64形式保存\n\n      editor.customConfig.onchange = function (html) {\n        _this4.dataForm.content = html;\n      };\n\n      editor.customConfig.customUploadImg = function (files, insert) {\n        var formData = new FormData();\n        formData.append('files', files[0]);\n        axios.post(\"http://admin.zhanchengwlkj.com:8080/derivative_system_backstage/file/addFile\", formData, {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\"\n          }\n        }).then(function (res) {\n          var data = res.data;\n          insert(data.data); // 插入图片到editor\n        }); // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n      };\n\n      editor.customConfig.uploadImgShowBase64 = true; //图片以base64形式保存\n\n      editor.create();\n    }\n\n    this.getfreightlist();\n  }\n};",null]}