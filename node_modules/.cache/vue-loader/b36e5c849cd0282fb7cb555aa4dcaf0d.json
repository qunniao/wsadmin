{"remainingRequest":"E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\HtmlProjects\\wsadmin\\src\\components\\prodTwo\\prodInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\HtmlProjects\\wsadmin\\src\\components\\prodTwo\\prodInfo.vue","mtime":1573375139543},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576862582236},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nconst AttributeIndex = () => import('./shopAttribute.vue');\nconst SecondIndex = () => import('./shoptype.vue');\nimport {\n  getProdDetailAPI,\n  getTemplateListAPI,\n  pushProdDataAPI,\n  putProdDataAPI\n}from '@/api/productApi.js'\nimport axios from 'axios';\nimport { treeDataTranslate, idList } from '@/utils'\nimport E from 'wangeditor';\nimport SkuTable from './sku-table'\nimport SkuTag from './sku-tag'\nexport default {\n   name:'editor',\n  data () {\n    return {\n      // 分类树展示与回显\n      transportId: null,\n      shopid:0,\n      shopup:'1',\n      shopdown:'1',\n      value1:'',\n      attrtext:'',\n      attributeDepList:[],\n      category: {\n        list: [],\n        selected: [],\n        props: {\n          value: 'categoryId',\n          label: 'categoryName'\n        }\n      },\n      rules: {\n        checkList: [\n                { type: 'array', required: true, message: '请选择代理购买方式', trigger: 'change' }\n              ],\n        picfile: [ \n            { required: true, message: '请上传图片' }          \n          ]\n      },\n      fileList:[],\n      freightlist:[],\n      allfreight:'',\n      AttributeDepShow:false,\n      secondDepShow:false,\n      imageShowUrl:'',\n      // 规格列表\n      shoptypelist:[],\n      skuList:[],\n      prodName:'',\n      dialogImageUrl: '',\n      dialogVisible: false,\n      dataForm: {\n        checkList:[],\n        productType:0,\n        sid:0,\n        productNumber:'',\n        productName: '',\n        cover:'',\n        productIntro:'',\n        price:'',\n        inviteReward:'',\n        marketPrice:'',\n        weight:'',\n        stockPrice:'',\n        isUniformFreight:'0',\n        showStock:1,\n        content:'',\n        retailFreightId:'',\n        agentFreightId:'',\n        cloudFreightId:'',\n        sales:'',\n        agentBuy:'',\n        sort:'',\n        putawayTime:'',\n        soldoutTime:'',\n        typeIds:[],\n        productParams:[],\n        units:[],\n        standardDtos:[],\n        productImageDtos:[]\n      },\n      tags: [],\n      // resourcesUrl: window.SITE_CONFIG.resourcesUrl\n    }\n  },\n  components: {\n    SkuTable,\n    SkuTag,\n    SecondIndex,\n    AttributeIndex\n  },\n  props: {\n    depId: {\n      required: true,\n    },\n  },\n  computed: {\n    defalutSku () {\n      return this.$store.state.prod.defalutSku\n    }\n  },\n  activated () {\n    this.dataForm.prodId = this.$route.query.prodId\n    this.getDataList()\n  },\n  methods: {\n    // 获取分类数据\n    getDataList () {\n     \n    },\n    handleRemove(file, fileList) {\n      for(let i=0;i<this.dataForm.productImageDtos.length;i++){\n        if(file.url==this.dataForm.productImageDtos[i].url){\n          this.dataForm.productImageDtos.splice(i,1)\n        }\n      }\n    },\n    uploadImgTwo(res){\n      this.dataForm.productImageDtos.push({\n        sort:0,\n        url:res.data\n      })\n    },\n    handlePictureCardPreview(file) {\n        this.dialogImageUrl = file.url;\n        this.dialogVisible = true;\n    },\n    removeDomain(item) {\n        for(let j=0;j<this.attributeDepList.length;j++){\n          if(this.attributeDepList[j].name==item.name){\n            this.attributeDepList.splice(j,1)\n          }\n        }\n      },\n    delshoptype(deltid){\n     for(let i=0;i<this.shoptypelist.length;i++){\n       if(this.shoptypelist[i].tid==deltid){\n         this.shoptypelist.splice(i,1)\n       }\n     }\n    },\n    saveattrtext(){\n      let isokpush =true;\n      for(let j=0;j<this.attributeDepList.length;j++){\n          if(this.attributeDepList[j].name==this.attrtext){\n            isokpush=false\n            this.$message({\n              type: 'error',\n              message: '不能添加已有属性值',\n            });\n          }\n      }\n      if(isokpush){\n        if(this.attrtext!=''){\n            this.attributeDepList.push({\n            name:this.attrtext,\n            value:''\n          })\n          \n          this.attrtext=''\n        }else{\n          this.$message({\n              type: 'error',\n              message: '属性值不能为空',\n            });\n        }\n      }\n    },\n    changeshoptype(typelist){\n      this.shoptypelist=typelist\n    },\n    changeattrlist(attrlist){\n      let attribute =attrlist.split(',')\n      for(let i=0;i<attribute.length;i++){\n        let ischeck=true\n        for(let j=0;j<this.attributeDepList.length;j++){\n          if(this.attributeDepList[j].name==attribute[i]){\n            ischeck=false\n          }\n        }\n        if(ischeck){\n          this.attributeDepList.push({name:attribute[i],value:''})\n        }\n      }\n    },\n    handleChange(){\n      \n    },\n    handleSecondDepShow(){\n      this.secondDepShow = true;\n    },\n    handleAttributeDepShow(){\n      this.AttributeDepShow=true\n    },\n    uploadImg(res){\n      this.dataForm.cover = res.data;\n      this.imageShowUrl=res.data\n      this.rules.picfile = [{ required: true, message: '请上传图片' }] \n      if (this.dataForm.cover!='') {\n        this.rules.picfile = []\n      }\n    },\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG或者PNG 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return isJPG && isLt2M;\n    },    \n    // 获取分类信息\n    getCategoryList () {\n    },\n    // 选择分类改变事件\n    handleCategoryChange (val) {\n      this.dataForm.categoryId = val[val.length - 1]\n    },\n    // 表单提交\n    dataFormSubmit () {\n          let that=this;\n        this.$refs['dataForm'].validate((valid) => {\n          if(valid){\n            if(this.shoptypelist.length<1){\n              this.$message({\n                type: 'error',\n                message: '产品分类不能为空',\n              });\n              return false\n            }\n            const pushdata =this.dataForm\n            if(this.dataForm.checkList.length==0){\n              pushdata.agentBuy=0\n            }else if(this.dataForm.checkList.length==2){\n              pushdata.agentBuy=3\n            }else{\n              if(this.dataForm.checkList[0]=='物流进货'){\n                pushdata.agentBuy=1\n              }else{\n                pushdata.agentBuy=2\n              }\n            }\n            if(this.shopup==1){\n              pushdata.putawayTime=0\n              if(this.shopdown==2){\n                pushdata.soldoutTime=0\n              }\n            }else if(this.shopup==3){\n              pushdata.putawayTime=0\n              pushdata.soldoutTime=0\n            }else{\n              if(this.shopdown==2){\n                pushdata.soldoutTime=0\n              }\n            }\n            pushdata.standardDtos=[]\n            pushdata.productGuigeNames=[]\n            if(this.skuList.length>0){\n               let skuguigelist =this.skuList[0].properties.split(';')\n               if(skuguigelist.length==1){\n                 pushdata.productGuigeNames.push({\n                   gname:skuguigelist[0],\n                   lvevl:1\n                 })\n               }else{\n                  pushdata.productGuigeNames.push({\n                   gname:skuguigelist[0],\n                   lvevl:1\n                 },{\n                   gname:skuguigelist[1],\n                   lvevl:2\n                 })\n               }\n            }\n            for(let i=0;i<this.skuList.length;i++){\n              let skulistdata={\n                sp1:'',\n                sp2:'',\n                productNumber:'',\n                price:'',\n                weight:'',\n                pic:''\n              }\n              let skulistsplist =this.skuList[i].properties.split(';')\n              if(skulistsplist.length<=1){\n                  skulistdata.sp1=skulistsplist[0].split(':')[1]\n                  skulistdata.productNumber=this.skuList[i].productNumber\n                  skulistdata.weight=this.skuList[i].weight\n                  skulistdata.price=this.skuList[i].price\n                  skulistdata.pic=this.skuList[i].pic\n              }else{\n                  skulistdata.sp1=skulistsplist[0].split(':')[1]\n                  skulistdata.sp2=skulistsplist[1].split(':')[1]\n                  skulistdata.productNumber=this.skuList[i].productNumber\n                  skulistdata.weight=this.skuList[i].weight\n                  skulistdata.price=this.skuList[i].price\n                  skulistdata.pic=this.skuList[i].pic\n              }\n              pushdata.standardDtos.push(skulistdata)\n            }\n            pushdata.typeIds=[]\n            for(let i=0;i<this.shoptypelist.length;i++){\n              pushdata.typeIds.push(this.shoptypelist[i].tid)\n            }\n            if(this.dataForm.isUniformFreight==2){\n              pushdata.retailFreightId=this.allfreight\n              pushdata.agentFreightId=this.allfreight\n              pushdata.cloudFreightId=this.allfreight\n            }\n            pushdata.productType=1\n            if(this.shopid!=0){\n              const putdata={\n                pid:this.shopid,\n                productType:1,\n                productNumber:pushdata.productNumber,\n                cover:pushdata.cover,\n                productName:pushdata.productName,\n                productIntro:'',\n                price:pushdata.price,\n                isUniformFreight:pushdata.isUniformFreight,\n                marketPrice:pushdata.marketPrice,\n                weight:pushdata.weight,\n                showStock:pushdata.showStock,\n                content:pushdata.content,\n                retailFreightId:pushdata.retailFreightId,\n                agentFreightId:pushdata.agentFreightId,\n                cloudFreightId:pushdata.cloudFreightId,\n                sales:pushdata.sales,\n                sort:pushdata.sort,\n                inviteReward:pushdata.inviteReward,\n                stockPrice:pushdata.stockPrice,\n                putawayTime:pushdata.putawayTime,\n                soldoutTime:pushdata.soldoutTime,\n                typeIds:pushdata.typeIds,\n                productParams:pushdata.productParams,\n                units:pushdata.units,\n                standardDtos:pushdata.standardDtos,\n                productImageDtos:pushdata.productImageDtos,\n              }\n              putProdDataAPI(putdata)\n                .then(res => {\n                    const sucresponse = res.data;\n                    if(sucresponse.code==200){\n                      this.$message({\n                        type: 'success',\n                        message: '修改产品成功',\n                      });\n                      this.$emit('close-form')\n                      this.$emit('finish-action')\n                    }else{\n                      this.errorMsg(sucresponse.message)\n                    }\n                })\n                .catch(err => {\n                  console.log(err)\n                    this.tableLoading = false;\n                }) \n            }else{\n              pushProdDataAPI(pushdata)\n                .then(res => {\n                    const response = res.data;\n                    if(response.code==200){\n                      this.$message({\n                        type: 'success',\n                        message: '添加产品成功',\n                      });\n                      this.$emit('close-form')\n                      this.$emit('finish-action')\n                    }else{\n                      this.errorMsg(response.message)\n                    }\n                })\n                .catch(err => {\n                  console.log(err)\n                    this.tableLoading = false;\n                })            \n            }\n          }\n         \n        })\n    },\n    paramSetPriceAndStocks (param) {\n      \n    },\n    skuTagChangeSkuHandler (skuList) {\n      const prodName = this.prodName\n      skuList.forEach(sku => {\n        if (sku.properties) {\n          sku.skuName = ''\n          let properties = sku.properties.split(';')\n          for (const propertiesKey in properties) {\n            sku.skuName += properties[propertiesKey].split(':')[1] + ' '\n          }\n          sku.prodName = prodName + ' ' + sku.skuName\n        }\n      })\n      this.skuList = skuList\n    },\n    getproddetail(id){\n      getProdDetailAPI(id)\n        .then(res => {\n          const data = res.data.data;\n          this.dataForm=data\n          this.dataForm.productImageDtos=data.productImageList\n          this.rules.picfile = [{ required: true, message: '请上传图片' }] \n          if (this.dataForm.cover!='') {\n            this.rules.picfile = []\n          }\n          if(data.agentBuy=0){\n              this.dataForm.checkList=[]\n          }else if(data.agentBuy=3){\n              this.dataForm.checkList=[\"物流进货\",\"云仓库储货\"]\n          }else{\n              if( data.agentBuy=1){\n                this.dataForm.checkList=[\"物流进货\"]\n              }else{\n                this.dataForm.checkList=[\"云仓库储货\"]\n              }\n          }\n          this.shoptypelist=data.productTypeList\n          this.dataForm.isUniformFreight=data.isUniformFreight\n          this.attributeDepList=data.productParamList\n          let skulistData =data.productSkuList\n          let skunamelist =data.productGuigeNameList\n          for(let i=0;i<skulistData.length;i++){\n            let skulistpushdata ={\n              pic: \"\",\n              price: 0,\n              prodName: \" 标签值 二级标签值 \",\n              productNumber: 0,\n              properties: \"一级标签:标签值;二级标签:二级标签值\",\n              skuName: \"标签值 二级标签值 \",\n              status: 1,\n              weight: 0,\n            }\n            skulistpushdata.pic=skulistData[i].pic\n            skulistpushdata.price=skulistData[i].price\n            skulistpushdata.weight=skulistData[i].weight\n            skulistpushdata.productNumber=skulistData[i].productNumber\n            if(skunamelist.length==2){\n              skulistpushdata.properties=skunamelist[0].gname+':'+skulistData[i].sp1+';'+skunamelist[1].gname+':'+skulistData[i].sp2\n              skulistpushdata.skuName=skulistData[i].sp1 + ' '+skulistData[i].sp2\n              skulistpushdata.prodName=' '+skulistData[i].sp1 + ' '+skulistData[i].sp2+' '\n            }else{\n               skulistpushdata.skuName=skulistData[i].sp1\n               skulistpushdata.properties=skunamelist[0].gname+':'+skulistData[i].sp1\n               skulistpushdata.skuName=skulistData[i].sp1\n               skulistpushdata.prodName=' '+skulistData[i].sp1\n            }\n            this.skuList.push(skulistpushdata)\n          }\n          if(data.status==-1){\n              this.shopup=\"3\"\n            }else{\n              if(data.putawayTime==0){\n                this.shopup=\"1\"\n                if(data.soldoutTime!=0){\n                  this.shopdown=\"1\"\n                }else{\n                  this.shopdown=\"2\"\n                }\n              }else{\n                this.shopup=\"2\"\n                if(data.soldoutTime!=0){\n                  this.shopdown=\"1\"\n                }else{\n                  this.shopdown=\"2\"\n                }\n              }\n            }\n\n            var editor = new E('#editorElem')\n            editor.customConfig.onchange = (html) => {\n              this.dataForm.content = html\n            }\n            editor.customConfig.customUploadImg = (files, insert) => {\n              const formData = new FormData();\n              formData.append('files', files[0]);\n               axios.post(\"http://admin.zhanchengwlkj.com:8080/derivative_system_backstage/file/addFile\", formData, {\n                  headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                  }\n                }).then(res => {\n                  let { data } = res\n                  insert(data.data)  \n                  // 插入图片到editor\n                });\n              // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n              \n            };\n            editor.customConfig.uploadImgShowBase64 = true //图片以base64形式保存\n            editor.create()\n            editor.txt.html(this.dataForm.content)\n        })\n        .catch(err => {\n            this.tableLoading = false;\n        })\n    },\n    errorMsg (message) {\n      this.$message({\n        message: message,\n        type: 'error',\n        duration: 1500\n      })\n    },\n    getfreightlist(){\n        const getTempParam = {\n          current:1,\n          size:100\n        };\n        getTemplateListAPI(getTempParam)\n            .then(res => {\n                const response = res.data.data.records;\n                this.freightlist =response\n            })\n            .catch(err => {\n                this.tableLoading = false;\n            })\n    }\n  },\n  mounted() {\n        //wangEditor自带方法\n        if(this.depId!=0){\n          this.shopid=this.depId\n          this.getproddetail(this.depId)\n        }else{\n            var editor = new E('#editorElem')\n            editor.customConfig.uploadImgShowBase64 = true //图片以base64形式保存\n            editor.customConfig.onchange = (html) => {\n              this.dataForm.content = html\n            }\n            editor.customConfig.customUploadImg = (files, insert) => {\n              const formData = new FormData();\n              formData.append('files', files[0]);\n               axios.post(\"http://admin.zhanchengwlkj.com:8080/derivative_system_backstage/file/addFile\", formData, {\n                  headers: {\n                    \"Content-Type\": \"multipart/form-data\"\n                  }\n                }).then(res => {\n                  let { data } = res\n                  insert(data.data)  \n                  // 插入图片到editor\n                });\n              // formData.append('path', 'files/ne-icev3-dashboard/content/content/');\n              \n            };\n            editor.customConfig.uploadImgShowBase64 = true //图片以base64形式保存\n            editor.create()\n        }\n        this.getfreightlist()\n    },\n}\n",null]}