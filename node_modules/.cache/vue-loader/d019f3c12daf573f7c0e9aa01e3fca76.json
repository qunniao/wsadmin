{"remainingRequest":"E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\HtmlProjects\\wsadmin\\src\\components\\LoginPageByPwd.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\HtmlProjects\\wsadmin\\src\\components\\LoginPageByPwd.vue","mtime":1577002927621},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576862582236},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {mapMutations, mapState, mapActions} from 'vuex'\n\nimport {BASE_URL} from '@/public/constant'\nimport {loginByPwdAPI,getCodeAPI} from '@/api/globalAPI'\n\nexport default {\n    name: 'HelloWorld',\n    data() {\n        return {\n            codeImg: null,\n            formLogin: {\n                phone: '',\n                password: '',\n             \n            },\n            count:\"\",\n            timer:null,\n            rules: {\n                username: [\n                    {\n                        required: true,\n                        message: '请输入用户名',\n                        trigger: 'blur'\n                    }\n                ],\n                password: [\n                    {\n                        required: true,\n                        message: '请输入密码',\n                        trigger: 'blur'\n                    }\n                ],\n               \n            },\n        };\n    },\n    methods: {\n\n        /**\n         * 提交登陆操作\n         */\n        submitLoginForm() {\n            const formLogin = {\n                ...this.formLogin\n            }\n            this.$refs.formLogin.validate(valid => {\n                if (valid) {\n                    loginByPwdAPI (formLogin).then(res => {\n                        const {code, data, message} = res.data\n                        console.log(res.data)\n                        console.log(code)\n                        if (code === 200) {\n                            var millisecond = new Date().getTime();\n                            var expiresTime = new Date(millisecond +60*60 * 1000);\n                            // console.log(expiresTime)\n                            // Cookies.set('token', 'value', {\n                            //     expires: expiresTime,\n                            // });\n                            // document.cookie = \"token=\"+  data.token + \";expires=\" + expiresTime.toGMTString();\n                            localStorage.setItem('token', data.token)\n                            // localStorage.setItem('tokendate',expiresTime)\n                            console.log(data)\n                            sessionStorage.setItem('token', data.admin.token)\n                            sessionStorage.setItem('roleId', data.admin.adminRoleId)\n                            sessionStorage.setItem('uid', data.admin.uid)\n                            // localStorage.setItem('rid', data.tid)\n                            // localStorage.setItem('username', formLogin.username)\n\n                            this.$message({type: 'success', message: '登陆成功！'})\n                            // 改变登录状态为已登录\n                            this\n                                .$store\n                                .commit('moduleLogin/login')\n                            // 跳转到应用\n                            this\n                                .$router\n                                .push('/')\n                        } else {\n                            this.$message({type: 'error', message: message})\n                        }\n                    })\n                }\n            })\n           \n        },\n        getcode(){\n            const that =this\n            if(!this.timer){\n                 if(!(/^1[3456789]\\d{9}$/.test(this.formLogin.phone))){ \n                    this.$message({type: 'error', message: '请输入正确的手机号码'}) \n                    return false; \n            }else{\n                const pushdata={\n                    phone:this.formLogin.phone\n                }\n                const TIME_COUNT = 60;\n                 if (!this.time) {\n                        this.count = TIME_COUNT;\n                        this.timer = setInterval(() => {\n                        if (this.count > 0 && this.count <= TIME_COUNT) {\n                            this.count--;\n                            } else {\n                            this.show = true;\n                            clearInterval(this.timer);\n                            this.timer = null;\n                            }\n                        }, 1000)\n                    }\n                    getCodeAPI(pushdata)\n                    .then(res => {\n                            const response = res.data;\n                            if(response.code==200){\n                                this.$message({\n                                    type: 'success',\n                                    message: '获取验证码成功',\n                                });\n                            }\n                        })\n                        .catch(err => {\n                        console.log(err)\n                            this.tableLoading = false;\n                        }) \n                }\n            }\n        },\n        errorMsg (message) {\n            this.$message({\n                message: message,\n                type: 'error',\n                duration: 1500\n            })\n        },\n    },\n    mounted() {\n    }\n}\n",null]}