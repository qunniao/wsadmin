{"remainingRequest":"E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\HtmlProjects\\wsadmin\\src\\components\\menu\\Index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\HtmlProjects\\wsadmin\\src\\components\\menu\\Index.vue","mtime":1577030576308},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576862582236},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576862582236},{"path":"E:\\HtmlProjects\\wsadmin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapState } from 'vuex'\n\nimport NavItem from'./NavItem';\nimport Vue from 'vue';\nimport router from '@/router';\nimport {Message} from 'element-ui';\n\nimport {\n    getAuthListAPI,getAdminRolePowerListAPI\n} from '@/api/globalAPI.js';\nimport { MENU_LIST } from '@/public/constant';\n\nexport default {\n    name:'NavMenu',\n    data() {\n        return {\n            menuList: [],\n        };\n    },\n    components: {\n        NavItem,\n    },\n    computed: {\n        ...mapState('menu', {\n            itemActiveIndex: state => state.itemActiveIndex,\n        })\n    },\n    methods: {\n        /**\n         * 菜单点击选择事件\n         */\n        handleSelectMenu(index) {\n            console.log(\"handleSelectMenu index:\"+index);\n            if (index !== this.itemActiveIndex) {\n                this.$store.commit('menu/changeActiveItem', index);\n            }\n        },\n        /**\n         * 构建对应权限菜单\n         */\n        buildAuthNav() {\n            const params ={\n                rid:Number(sessionStorage.getItem('roleId'))\n            }\n            getAuthListAPI(params)\n                .then(res => {\n                    // console.log(res.data.data)\n                    let authList = res.data.data.map(item => item.menu.name);\n\n                    function buildNewMenu(arrayDone) {\n                        let newArray = [];\n                        arrayDone.forEach((item, index) => {\n                            if (item.children && item.children.length > 0) {\n                                // 递归过滤 children \n                                let newChildren = buildNewMenu(item.children);\n                                // 如果过滤后的 newChildren 长度大于零，push 该菜单\n                                if (newChildren.length > 0) {\n                                    newArray.push(Object.assign({}, item, {\n                                        children: newChildren,\n                                    }));\n                                }\n                            } else {\n                                if (authList.indexOf(item.name) > -1) {\n                                    newArray.push(item);\n                                }\n                            }\n                        });\n\n                        return newArray;\n                    }\n\n                    let newMenu = buildNewMenu(MENU_LIST);\n                    this.menuList = newMenu;\n                })\n        },\n         /**\n         * 构建对应权限菜单2\n         */\n        buildAuthNav2() {\n            const params ={\n                roleId:Number(sessionStorage.getItem('roleId'))\n            }\n            getAdminRolePowerListAPI(params)\n                .then(res => {\n                    console.log(\"buildAuthNav2\")\n                    console.log(res.data)\n                    let authList = res.data.data;\n                    /*\n                    function buildNewMenu(arrayDone) {\n                        let newArray = [];\n                        arrayDone.forEach((item, index) => {\n                            if (item.children && item.children.length > 0) {\n                                // 递归过滤 children \n                                let newChildren = buildNewMenu(item.children);\n                                // 如果过滤后的 newChildren 长度大于零，push 该菜单\n                                if (newChildren.length > 0) {\n                                    newArray.push(Object.assign({}, item, {\n                                        children: newChildren,\n                                    }));\n                                }\n                            } else {\n                                if (authList.indexOf(item.name) > -1) {\n                                    newArray.push(item);\n                                }\n                            }\n                        });\n\n                        return newArray;\n                    }\n                    */\n\n                   // let newMenu = buildNewMenu(MENU_LIST);\n                    this.menuList = authList;\n                })\n        },\n        getCookie(c_name) {\n            if (document.cookie.length > 0) {\n                var c_start = document.cookie.indexOf(c_name + \"=\")\n                if (c_start != -1) {\n                    c_start = c_start + c_name.length + 1\n                    var c_end = document.cookie.indexOf(\";\", c_start)\n                    if (c_end == -1) c_end = document.cookie.length\n                    return unescape(document.cookie.substring(c_start, c_end)).replace(/\\\"/g, \"\");\n                }\n            }\n            return null;\n        }\n    },\n    created() {\n        //  this.menuList = MENU_LIST;\n        this.buildAuthNav2();\n        // console.log(this.getCookie(\"userId\"))\n        // if(sessionStorage.getItem('token')==undefined||sessionStorage.getItem('token')==null||sessionStorage.getItem('token')==''){\n        //     Vue.prototype.$message({type: 'error', message: '登录信息过期！请重新登录'})\n        //     // reject('登录信息过期！请重新登录');\n        //     router.push('/login');\n        // }\n        // 重新登录设置首页为初始页面\n        this.$store.commit('menu/changeActiveItem', 'home')\n    },\n}\n",{"version":3,"sources":["Index.vue"],"names":[],"mappings":";;;;;;;;;;;;;AAaA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Index.vue","sourceRoot":"src\\components\\menu","sourcesContent":["<!-- 菜单入口 -->\n<template>\n    <el-menu \n    @select=\"handleSelectMenu\" \n    :default-active=\"itemActiveIndex\" \n    :active-text-color=\"itemActiveIndex ? '#409EFF' : '#303133'\"\n    :unique-opened=\"true\">\n        <!-- <nav-item :key=\"index\" v-for=\"(item, index) in menuList\" :menuItem=\"item\" :menuIndex=\"index + ''\"></nav-item> -->\n        <nav-item :key=\"item.actionId\" v-for=\"item in menuList\" :menuItem=\"item\"  :menuIndex=\"item.actionId\"></nav-item>\n    </el-menu>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\n\nimport NavItem from'./NavItem';\nimport Vue from 'vue';\nimport router from '@/router';\nimport {Message} from 'element-ui';\n\nimport {\n    getAuthListAPI,getAdminRolePowerListAPI\n} from '@/api/globalAPI.js';\nimport { MENU_LIST } from '@/public/constant';\n\nexport default {\n    name:'NavMenu',\n    data() {\n        return {\n            menuList: [],\n        };\n    },\n    components: {\n        NavItem,\n    },\n    computed: {\n        ...mapState('menu', {\n            itemActiveIndex: state => state.itemActiveIndex,\n        })\n    },\n    methods: {\n        /**\n         * 菜单点击选择事件\n         */\n        handleSelectMenu(index) {\n            console.log(\"handleSelectMenu index:\"+index);\n            if (index !== this.itemActiveIndex) {\n                this.$store.commit('menu/changeActiveItem', index);\n            }\n        },\n        /**\n         * 构建对应权限菜单\n         */\n        buildAuthNav() {\n            const params ={\n                rid:Number(sessionStorage.getItem('roleId'))\n            }\n            getAuthListAPI(params)\n                .then(res => {\n                    // console.log(res.data.data)\n                    let authList = res.data.data.map(item => item.menu.name);\n\n                    function buildNewMenu(arrayDone) {\n                        let newArray = [];\n                        arrayDone.forEach((item, index) => {\n                            if (item.children && item.children.length > 0) {\n                                // 递归过滤 children \n                                let newChildren = buildNewMenu(item.children);\n                                // 如果过滤后的 newChildren 长度大于零，push 该菜单\n                                if (newChildren.length > 0) {\n                                    newArray.push(Object.assign({}, item, {\n                                        children: newChildren,\n                                    }));\n                                }\n                            } else {\n                                if (authList.indexOf(item.name) > -1) {\n                                    newArray.push(item);\n                                }\n                            }\n                        });\n\n                        return newArray;\n                    }\n\n                    let newMenu = buildNewMenu(MENU_LIST);\n                    this.menuList = newMenu;\n                })\n        },\n         /**\n         * 构建对应权限菜单2\n         */\n        buildAuthNav2() {\n            const params ={\n                roleId:Number(sessionStorage.getItem('roleId'))\n            }\n            getAdminRolePowerListAPI(params)\n                .then(res => {\n                    console.log(\"buildAuthNav2\")\n                    console.log(res.data)\n                    let authList = res.data.data;\n                    /*\n                    function buildNewMenu(arrayDone) {\n                        let newArray = [];\n                        arrayDone.forEach((item, index) => {\n                            if (item.children && item.children.length > 0) {\n                                // 递归过滤 children \n                                let newChildren = buildNewMenu(item.children);\n                                // 如果过滤后的 newChildren 长度大于零，push 该菜单\n                                if (newChildren.length > 0) {\n                                    newArray.push(Object.assign({}, item, {\n                                        children: newChildren,\n                                    }));\n                                }\n                            } else {\n                                if (authList.indexOf(item.name) > -1) {\n                                    newArray.push(item);\n                                }\n                            }\n                        });\n\n                        return newArray;\n                    }\n                    */\n\n                   // let newMenu = buildNewMenu(MENU_LIST);\n                    this.menuList = authList;\n                })\n        },\n        getCookie(c_name) {\n            if (document.cookie.length > 0) {\n                var c_start = document.cookie.indexOf(c_name + \"=\")\n                if (c_start != -1) {\n                    c_start = c_start + c_name.length + 1\n                    var c_end = document.cookie.indexOf(\";\", c_start)\n                    if (c_end == -1) c_end = document.cookie.length\n                    return unescape(document.cookie.substring(c_start, c_end)).replace(/\\\"/g, \"\");\n                }\n            }\n            return null;\n        }\n    },\n    created() {\n        //  this.menuList = MENU_LIST;\n        this.buildAuthNav2();\n        // console.log(this.getCookie(\"userId\"))\n        // if(sessionStorage.getItem('token')==undefined||sessionStorage.getItem('token')==null||sessionStorage.getItem('token')==''){\n        //     Vue.prototype.$message({type: 'error', message: '登录信息过期！请重新登录'})\n        //     // reject('登录信息过期！请重新登录');\n        //     router.push('/login');\n        // }\n        // 重新登录设置首页为初始页面\n        this.$store.commit('menu/changeActiveItem', 'home')\n    },\n}\n</script>\n\n<style scoped lang=\"less\">\n</style>"]}]}